# å°é¹…é€šè§†é¢‘æ‰¹é‡ä¸‹è½½å·¥å…· (XET Video Downloader)

ä¸€ä¸ªåŸºäº Playwright å’Œ yt-dlp çš„è‡ªåŠ¨åŒ–è§†é¢‘ä¸‹è½½å·¥å…·ï¼Œä¸“é—¨ç”¨äºæ‰¹é‡ä¸‹è½½å°é¹…é€šå¹³å°çš„è§†é¢‘è¯¾ç¨‹ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ¯ **è‡ªåŠ¨æ•è·** - ä½¿ç”¨ Playwright è‡ªåŠ¨æ‹¦æˆªå¹¶æ•è· m3u8 è§†é¢‘åœ°å€
- ğŸ” **ç™»å½•ä¿æŒ** - ä½¿ç”¨æŒä¹…åŒ–æµè§ˆå™¨ä¼šè¯ï¼Œé¦–æ¬¡ç™»å½•åè‡ªåŠ¨ä¿å­˜çŠ¶æ€
- ğŸ“¦ **æ‰¹é‡ä¸‹è½½** - æ”¯æŒæ‰¹é‡å¤„ç†å¤šä¸ªè§†é¢‘URL
- ğŸ¬ **é«˜æ¸…ä¼˜å…ˆ** - è‡ªåŠ¨æ•è·æœ€é«˜æ¸…æ™°åº¦ç‰ˆæœ¬ (f421220)
- ğŸ“Š **å‹å¥½ç•Œé¢** - ä½¿ç”¨ Rich åº“æä¾›ç¾è§‚çš„ç»ˆç«¯ç•Œé¢
- ğŸ’¾ **ä¿¡æ¯ä¿å­˜** - å¯é€‰ä¿å­˜æ•è·çš„è§†é¢‘ä¿¡æ¯ä¸º JSON æ–‡ä»¶
- âš¡ **å¹¶å‘ä¸‹è½½** - ä½¿ç”¨ yt-dlp çš„å¹¶å‘åˆ†ç‰‡ä¸‹è½½åŠ é€Ÿ

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- macOS / Linux / Windows
- [uv](https://docs.astral.sh/uv/) - Python åŒ…ç®¡ç†å·¥å…·
- [yt-dlp](https://github.com/yt-dlp/yt-dlp) - è§†é¢‘ä¸‹è½½å·¥å…·
- [ffmpeg](https://ffmpeg.org/) - è§†é¢‘å¤„ç†å·¥å…·ï¼ˆæ¨èï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ç³»ç»Ÿä¾èµ–

**macOS (ä½¿ç”¨ Homebrew):**
```bash
brew install yt-dlp ffmpeg
```

**Linux (Ubuntu/Debian):**
```bash
sudo apt install yt-dlp ffmpeg
```

**Windows (ä½¿ç”¨ Scoop):**
```bash
scoop install yt-dlp ffmpeg
```

æˆ–è€…ä½¿ç”¨ pip:
```bash
pip install yt-dlp
```

### 2. å®‰è£… uv

```bash
# macOS/Linux
curl -LsSf https://astral.sh/uv/install.sh | sh

# Windows
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

### 3. å®‰è£…é¡¹ç›®ä¾èµ–

```bash
# å…‹éš†æˆ–è¿›å…¥é¡¹ç›®ç›®å½•
cd fetch-video

# ä½¿ç”¨ uv å®‰è£…ä¾èµ–
uv sync

# å®‰è£… Playwright æµè§ˆå™¨é©±åŠ¨
uv run playwright install chromium
```

### 4. è¿è¡Œç¨‹åº

```bash
uv run python main.py
```

## ğŸ“– ä½¿ç”¨æŒ‡å—

### äº¤äº’å¼ä½¿ç”¨

è¿è¡Œç¨‹åºåï¼ŒæŒ‰ç…§æç¤ºæ“ä½œï¼š

1. **è¾“å…¥ URL**
   - é€‰é¡¹ 1: æ‰‹åŠ¨è¾“å…¥å•ä¸ªæˆ–å¤šä¸ªURLï¼ˆç”¨é€—å·åˆ†éš”ï¼‰
   - é€‰é¡¹ 2: ä»æ–‡æœ¬æ–‡ä»¶è¯»å–URLåˆ—è¡¨

2. **é€‰æ‹©æµè§ˆå™¨æ¨¡å¼**
   - é¦–æ¬¡è¿è¡Œå»ºè®®æ˜¾ç¤ºæµè§ˆå™¨çª—å£ï¼Œä»¥ä¾¿å®Œæˆç™»å½•
   - åç»­å¯ä»¥ä½¿ç”¨æ— å¤´æ¨¡å¼ï¼ˆåå°è¿è¡Œï¼‰

3. **ç­‰å¾…æ•è·**
   - ç¨‹åºä¼šè‡ªåŠ¨è®¿é—®æ¯ä¸ªURLå¹¶æ•è· m3u8 åœ°å€
   - æ•è·æˆåŠŸåä¼šæ˜¾ç¤ºè§†é¢‘åˆ—è¡¨

4. **ä¸‹è½½è§†é¢‘**
   - ç¡®è®¤ä¸‹è½½åï¼Œç¨‹åºä¼šè‡ªåŠ¨ä¸‹è½½æ‰€æœ‰è§†é¢‘
   - è§†é¢‘ä¿å­˜åœ¨ `downloads` ç›®å½•

### ä»æ–‡ä»¶æ‰¹é‡ä¸‹è½½

åˆ›å»º `urls.txt` æ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªURLï¼š

```text
https://appezrn4igg1968.h5.xet.citv.cn/p/course/video/v_xxx1
https://appezrn4igg1968.h5.xet.citv.cn/p/course/video/v_xxx2
https://appezrn4igg1968.h5.xet.citv.cn/p/course/video/v_xxx3
```

ç„¶åè¿è¡Œç¨‹åºï¼Œé€‰æ‹©é€‰é¡¹ 2ï¼Œè¾“å…¥æ–‡ä»¶è·¯å¾„ã€‚

## ğŸ”§ é…ç½®è¯´æ˜

### ç›®å½•ç»“æ„

```
fetch-video/
â”œâ”€â”€ main.py                    # ä¸»ç¨‹åº
â”œâ”€â”€ pyproject.toml            # é¡¹ç›®é…ç½®ï¼ˆuv ç®¡ç†ï¼‰
â”œâ”€â”€ README.md                 # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ .gitignore               # Git å¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ browser_session/         # æµè§ˆå™¨ä¼šè¯æ•°æ®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”œâ”€â”€ downloads/               # è§†é¢‘ä¸‹è½½ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â””â”€â”€ captured_videos.json     # æ•è·çš„è§†é¢‘ä¿¡æ¯ï¼ˆå¯é€‰ç”Ÿæˆï¼‰
```

### è‡ªå®šä¹‰é…ç½®

æ‚¨å¯ä»¥åœ¨ä»£ç ä¸­ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š

```python
# main.py ä¸­çš„ VideoDownloader ç±»åˆå§‹åŒ–
downloader = VideoDownloader(
    user_data_dir="./browser_session",  # æµè§ˆå™¨ä¼šè¯ç›®å½•
    output_dir="./downloads"             # è§†é¢‘è¾“å‡ºç›®å½•
)
```

## ğŸ› ï¸ é«˜çº§ç”¨æ³•

### ä»…æ•è·ä¸ä¸‹è½½

ç¨‹åºæ”¯æŒå…ˆæ•è·è§†é¢‘ä¿¡æ¯ï¼Œä¿å­˜ä¸º JSONï¼Œç¨åå†ä¸‹è½½ï¼š

```python
from main import VideoDownloader

downloader = VideoDownloader()
urls = ["https://..."]
downloader.capture_video_urls(urls, headless=True)
downloader.save_captured_info("videos.json")
```

### è‡ªå®šä¹‰ä¸‹è½½å‚æ•°

ä¿®æ”¹ `download_video` æ–¹æ³•ä¸­çš„ yt-dlp å‚æ•°ï¼š

```python
cmd = [
    "yt-dlp",
    "--referer", referer,
    "--concurrent-fragments", "10",  # å¢åŠ å¹¶å‘æ•°
    "--format", "best",               # æŒ‡å®šæ ¼å¼
    "--merge-output-format", "mp4",  # åˆå¹¶æ ¼å¼
    "-o", output_template,
    media_url
]
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡ç™»å½•**
   - é¦–æ¬¡è¿è¡Œè¯·é€‰æ‹©"æ˜¾ç¤ºæµè§ˆå™¨çª—å£"
   - åœ¨å¼¹å‡ºçš„æµè§ˆå™¨ä¸­å®Œæˆå¾®ä¿¡/æ‰‹æœºå·ç™»å½•
   - ç™»å½•åä¼šè‡ªåŠ¨ä¿å­˜åœ¨ `browser_session` ç›®å½•

2. **å¤šæ¸…æ™°åº¦**
   - ç¨‹åºé»˜è®¤æ•è·æœ€é«˜æ¸…ç‰ˆæœ¬ï¼ˆv.f421220ï¼‰
   - å¦‚éœ€å…¶ä»–æ¸…æ™°åº¦ï¼Œå¯ä¿®æ”¹ `setup_request_handler` ä¸­çš„è¿‡æ»¤æ¡ä»¶

3. **ç½‘ç»œé—®é¢˜**
   - ç¡®ä¿ç½‘ç»œç¨³å®š
   - ä¸‹è½½å¤±è´¥å¯ä»¥é‡æ–°è¿è¡Œç¨‹åºï¼Œå·²ä¸‹è½½çš„è§†é¢‘ä¸ä¼šé‡å¤ä¸‹è½½

4. **æ³•å¾‹å£°æ˜**
   - ä»…ç”¨äºä¸‹è½½æ‚¨å·²è´­ä¹°/æœ‰æƒè®¿é—®çš„è¯¾ç¨‹
   - è¯·å‹¿ç”¨äºä¾µæƒç›®çš„

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜: æœªæ•è·åˆ°è§†é¢‘åœ°å€

**è§£å†³æ–¹æ¡ˆ:**
- ç¡®ä¿å·²ç™»å½•ï¼ˆä½¿ç”¨æ˜¾ç¤ºæµè§ˆå™¨æ¨¡å¼ï¼‰
- å¢åŠ ç­‰å¾…æ—¶é—´ï¼ˆä¿®æ”¹ `page.wait_for_timeout(5000)` çš„å€¼ï¼‰
- æ£€æŸ¥ URL æ˜¯å¦æ­£ç¡®

### é—®é¢˜: ä¸‹è½½å¤±è´¥

**è§£å†³æ–¹æ¡ˆ:**
- æ£€æŸ¥ yt-dlp å’Œ ffmpeg æ˜¯å¦æ­£ç¡®å®‰è£…
- æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯ç½‘ç»œé—®é¢˜
- å°è¯•æ‰‹åŠ¨ä½¿ç”¨ yt-dlp ä¸‹è½½æµ‹è¯•

### é—®é¢˜: Playwright æµè§ˆå™¨æœªå®‰è£…

**è§£å†³æ–¹æ¡ˆ:**
```bash
uv run playwright install chromium
```

## ğŸ“ ç¤ºä¾‹

### ç¤ºä¾‹ 1: ä¸‹è½½å•ä¸ªè§†é¢‘

```bash
$ uv run python main.py
# é€‰æ‹©é€‰é¡¹ 1: æ‰‹åŠ¨è¾“å…¥
# è¾“å…¥ URL: https://appezrn4igg1968.h5.xet.citv.cn/p/course/video/v_xxx
# é€‰æ‹©æ˜¾ç¤ºæµè§ˆå™¨: æ˜¯
# ç­‰å¾…æ•è·...
# ç¡®è®¤ä¸‹è½½: æ˜¯
```

### ç¤ºä¾‹ 2: æ‰¹é‡ä¸‹è½½

åˆ›å»º `urls.txt`:
```
https://appezrn4igg1968.h5.xet.citv.cn/p/course/video/v_xxx1
https://appezrn4igg1968.h5.xet.citv.cn/p/course/video/v_xxx2
```

è¿è¡Œ:
```bash
$ uv run python main.py
# é€‰æ‹©é€‰é¡¹ 2: ä»æ–‡ä»¶è¯»å–
# è¾“å…¥æ–‡ä»¶è·¯å¾„: urls.txt
# é€‰æ‹©æ˜¾ç¤ºæµè§ˆå™¨: å¦ï¼ˆå¦‚å·²ç™»å½•ï¼‰
# ç­‰å¾…æ•è·...
# ç¡®è®¤ä¸‹è½½: æ˜¯
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

- [Playwright](https://playwright.dev/) - æµè§ˆå™¨è‡ªåŠ¨åŒ–
- [yt-dlp](https://github.com/yt-dlp/yt-dlp) - è§†é¢‘ä¸‹è½½
- [Rich](https://github.com/Textualize/rich) - ç»ˆç«¯ç¾åŒ–

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·æäº¤ Issueã€‚

---

**Happy Downloading! ğŸ‰**

